#include "HandsFuck.hpp"
#include "../../Core/Hooks/HooksManager.hpp"
#include <spdlog/spdlog.h>

HandsFuckModule::HandsFuckModule(ModulesManager* const modules, HooksManager* const hooks, Config& cfg)
	: ModuleBase(HANDSFUCK_MODULE_NAME, modules, hooks, cfg)
{
}

void HandsFuckModule::Run()
{	
	auto& ctx = hooks->GetGameContext();

	if (ctx.localPlayer == nullptr) return;
	if (ctx.localPlayer->player == nullptr) return;
	if (ctx.players.empty()) return;

	auto& pos = ctx.localPlayer->player->pos;
	auto* target = ctx.players.front();
	
	if (target == nullptr) return;

	if (cfg.bHandsFuck)
	{
		if (GetAsyncKeyState(VK_DOWN) & 1)
		{
			hooks->TransformTranslate2(ctx.localPlayer, Vector3(0.0f, -cfg.fClipDistance, 0.0f));
		}

		if (GetAsyncKeyState(VK_UP) & 1)
		{
			hooks->TransformTranslate2(ctx.localPlayer, Vector3(0.0f, cfg.fClipDistance, 0.0f));
		}

		if (GetAsyncKeyState(VK_LEFT) & 1)
		{
			hooks->TransformTranslate2(ctx.localPlayer, Vector3(-cfg.fClipDistance, 0.0f, 0.0f));
		}

		if (GetAsyncKeyState(VK_RIGHT) & 1)
		{
			hooks->TransformTranslate2(ctx.localPlayer, Vector3(cfg.fClipDistance, 0.0f, 0.0f));
		}
	}
}
